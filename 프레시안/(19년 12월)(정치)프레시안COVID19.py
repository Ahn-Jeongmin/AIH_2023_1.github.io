import excluded as ex
import requests
from bs4 import BeautifulSoup
from collections import Counter
import re
import numpy as np
import matplotlib.pyplot as plt
from konlpy.tag import Okt

plt.rc("font", family="Malgun Gothic")

urls=['https://www.pressian.com/pages/articles/272260', 'https://www.pressian.com/pages/articles/272253', 'https://www.pressian.com/pages/articles/272189', 'https://www.pressian.com/pages/articles/272212', 'https://www.pressian.com/pages/articles/272202', 'https://www.pressian.com/pages/articles/272200', 'https://www.pressian.com/pages/articles/272193', 'https://www.pressian.com/pages/articles/272121', 'https://www.pressian.com/pages/articles/272125', 'https://www.pressian.com/pages/articles/272090', 'https://www.pressian.com/pages/articles/272089', 'https://www.pressian.com/pages/articles/272051', 'https://www.pressian.com/pages/articles/272038', 'https://www.pressian.com/pages/articles/271884', 'https://www.pressian.com/pages/articles/272035', 'https://www.pressian.com/pages/articles/272032', 'https://www.pressian.com/pages/articles/272010', 'https://www.pressian.com/pages/articles/271995', 'https://www.pressian.com/pages/articles/271988', 'https://www.pressian.com/pages/articles/271987', 'https://www.pressian.com/pages/articles/271942', 'https://www.pressian.com/pages/articles/271932', 'https://www.pressian.com/pages/articles/271872', 'https://www.pressian.com/pages/articles/271869', 'https://www.pressian.com/pages/articles/271848', 'https://www.pressian.com/pages/articles/271844', 'https://www.pressian.com/pages/articles/271824', 'https://www.pressian.com/pages/articles/271823', 'https://www.pressian.com/pages/articles/271813', 'https://www.pressian.com/pages/articles/271811', 'https://www.pressian.com/pages/articles/271797', 'https://www.pressian.com/pages/articles/271782', 'https://www.pressian.com/pages/articles/271771', 'https://www.pressian.com/pages/articles/271767', 'https://www.pressian.com/pages/articles/271693', 'https://www.pressian.com/pages/articles/271694', 'https://www.pressian.com/pages/articles/271683', 'https://www.pressian.com/pages/articles/271684', 'https://www.pressian.com/pages/articles/271611', 'https://www.pressian.com/pages/articles/271593', 'https://www.pressian.com/pages/articles/271581', 'https://www.pressian.com/pages/articles/271584', 'https://www.pressian.com/pages/articles/271585', 'https://www.pressian.com/pages/articles/271524', 'https://www.pressian.com/pages/articles/271516', 'https://www.pressian.com/pages/articles/271487', 'https://www.pressian.com/pages/articles/271489', 'https://www.pressian.com/pages/articles/271405', 'https://www.pressian.com/pages/articles/271404', 'https://www.pressian.com/pages/articles/271396', 'https://www.pressian.com/pages/articles/271398', 'https://www.pressian.com/pages/articles/271395', 'https://www.pressian.com/pages/articles/271391', 'https://www.pressian.com/pages/articles/271294', 'https://www.pressian.com/pages/articles/271261', 'https://www.pressian.com/pages/articles/271342', 'https://www.pressian.com/pages/articles/271260', 'https://www.pressian.com/pages/articles/270223', 'https://www.pressian.com/pages/articles/271289', 'https://www.pressian.com/pages/articles/271259', 'https://www.pressian.com/pages/articles/271254', 'https://www.pressian.com/pages/articles/271225', 'https://www.pressian.com/pages/articles/271224', 'https://www.pressian.com/pages/articles/271215', 'https://www.pressian.com/pages/articles/271196', 'https://www.pressian.com/pages/articles/271178', 'https://www.pressian.com/pages/articles/271149', 'https://www.pressian.com/pages/articles/271140', 'https://www.pressian.com/pages/articles/271084', 'https://www.pressian.com/pages/articles/271128', 'https://www.pressian.com/pages/articles/271038', 'https://www.pressian.com/pages/articles/271126', 'https://www.pressian.com/pages/articles/271050', 'https://www.pressian.com/pages/articles/271066', 'https://www.pressian.com/pages/articles/271072', 'https://www.pressian.com/pages/articles/271063', 'https://www.pressian.com/pages/articles/271051', 'https://www.pressian.com/pages/articles/271033', 'https://www.pressian.com/pages/articles/271012', 'https://www.pressian.com/pages/articles/271011', 'https://www.pressian.com/pages/articles/271004', 'https://www.pressian.com/pages/articles/270750', 'https://www.pressian.com/pages/articles/270963', 'https://www.pressian.com/pages/articles/270956', 'https://www.pressian.com/pages/articles/270952', 'https://www.pressian.com/pages/articles/270950', 'https://www.pressian.com/pages/articles/270782', 'https://www.pressian.com/pages/articles/270774', 'https://www.pressian.com/pages/articles/270756', 'https://www.pressian.com/pages/articles/270758', 'https://www.pressian.com/pages/articles/270755', 'https://www.pressian.com/pages/articles/270596', 'https://www.pressian.com/pages/articles/270601', 'https://www.pressian.com/pages/articles/270656', 'https://www.pressian.com/pages/articles/270662', 'https://www.pressian.com/pages/articles/270585', 'https://www.pressian.com/pages/articles/270640', 'https://www.pressian.com/pages/articles/270587', 'https://www.pressian.com/pages/articles/270582', 'https://www.pressian.com/pages/articles/270557', 'https://www.pressian.com/pages/articles/270577', 'https://www.pressian.com/pages/articles/270550', 'https://www.pressian.com/pages/articles/270546', 'https://www.pressian.com/pages/articles/270506', 'https://www.pressian.com/pages/articles/270486', 'https://www.pressian.com/pages/articles/270487', 'https://www.pressian.com/pages/articles/270485', 'https://www.pressian.com/pages/articles/270430', 'https://www.pressian.com/pages/articles/270405', 'https://www.pressian.com/pages/articles/270379', 'https://www.pressian.com/pages/articles/270369', 'https://www.pressian.com/pages/articles/270297', 'https://www.pressian.com/pages/articles/270267', 'https://www.pressian.com/pages/articles/270260', 'https://www.pressian.com/pages/articles/270264', 'https://www.pressian.com/pages/articles/270221', 'https://www.pressian.com/pages/articles/270213', 'https://www.pressian.com/pages/articles/270184', 'https://www.pressian.com/pages/articles/270155', 'https://www.pressian.com/pages/articles/270138', 'https://www.pressian.com/pages/articles/270129', 'https://www.pressian.com/pages/articles/270104', 'https://www.pressian.com/pages/articles/270101', 'https://www.pressian.com/pages/articles/270081', 'https://www.pressian.com/pages/articles/270012', 'https://www.pressian.com/pages/articles/270062', 'https://www.pressian.com/pages/articles/270043', 'https://www.pressian.com/pages/articles/270011', 'https://www.pressian.com/pages/articles/270002', 'https://www.pressian.com/pages/articles/269968', 'https://www.pressian.com/pages/articles/269952', 'https://www.pressian.com/pages/articles/269949', 'https://www.pressian.com/pages/articles/269947', 'https://www.pressian.com/pages/articles/269944', 'https://www.pressian.com/pages/articles/269940', 'https://www.pressian.com/pages/articles/269941', 'https://www.pressian.com/pages/articles/269939', 'https://www.pressian.com/pages/articles/269923', 'https://www.pressian.com/pages/articles/269868', 'https://www.pressian.com/pages/articles/269850', 'https://www.pressian.com/pages/articles/269856', 'https://www.pressian.com/pages/articles/269821', 'https://www.pressian.com/pages/articles/269809', 'https://www.pressian.com/pages/articles/269800', 'https://www.pressian.com/pages/articles/269791', 'https://www.pressian.com/pages/articles/269780', 'https://www.pressian.com/pages/articles/269754', 'https://www.pressian.com/pages/articles/269753', 'https://www.pressian.com/pages/articles/269740', 'https://www.pressian.com/pages/articles/269735', 'https://www.pressian.com/pages/articles/269688', 'https://www.pressian.com/pages/articles/269665', 'https://www.pressian.com/pages/articles/269586', 'https://www.pressian.com/pages/articles/269590', 'https://www.pressian.com/pages/articles/269561', 'https://www.pressian.com/pages/articles/269562', 'https://www.pressian.com/pages/articles/269549', 'https://www.pressian.com/pages/articles/269533', 'https://www.pressian.com/pages/articles/269470', 'https://www.pressian.com/pages/articles/269472', 'https://www.pressian.com/pages/articles/269441', 'https://www.pressian.com/pages/articles/269440', 'https://www.pressian.com/pages/articles/269421', 'https://www.pressian.com/pages/articles/269419', 'https://www.pressian.com/pages/articles/269407', 'https://www.pressian.com/pages/articles/269370', 'https://www.pressian.com/pages/articles/269353', 'https://www.pressian.com/pages/articles/269305', 'https://www.pressian.com/pages/articles/269303', 'https://www.pressian.com/pages/articles/269225', 'https://www.pressian.com/pages/articles/269249', 'https://www.pressian.com/pages/articles/269204', 'https://www.pressian.com/pages/articles/269179', 'https://www.pressian.com/pages/articles/269129', 'https://www.pressian.com/pages/articles/269122', 'https://www.pressian.com/pages/articles/269069', 'https://www.pressian.com/pages/articles/269116', 'https://www.pressian.com/pages/articles/268959', 'https://www.pressian.com/pages/articles/269049', 'https://www.pressian.com/pages/articles/269071', 'https://www.pressian.com/pages/articles/269068', 'https://www.pressian.com/pages/articles/269029', 'https://www.pressian.com/pages/articles/269017', 'https://www.pressian.com/pages/articles/268986', 'https://www.pressian.com/pages/articles/268957', 'https://www.pressian.com/pages/articles/268961', 'https://www.pressian.com/pages/articles/268956', 'https://www.pressian.com/pages/articles/268954', 'https://www.pressian.com/pages/articles/268940', 'https://www.pressian.com/pages/articles/268925', 'https://www.pressian.com/pages/articles/268907', 'https://www.pressian.com/pages/articles/268906', 'https://www.pressian.com/pages/articles/268903', 'https://www.pressian.com/pages/articles/268886', 'https://www.pressian.com/pages/articles/268885', 'https://www.pressian.com/pages/articles/268831', 'https://www.pressian.com/pages/articles/268411', 'https://www.pressian.com/pages/articles/268799', 'https://www.pressian.com/pages/articles/268777', 'https://www.pressian.com/pages/articles/268744', 'https://www.pressian.com/pages/articles/268736', 'https://www.pressian.com/pages/articles/268740', 'https://www.pressian.com/pages/articles/268705', 'https://www.pressian.com/pages/articles/268694', 'https://www.pressian.com/pages/articles/268652', 'https://www.pressian.com/pages/articles/268635', 'https://www.pressian.com/pages/articles/268656', 'https://www.pressian.com/pages/articles/268631', 'https://www.pressian.com/pages/articles/268605', 'https://www.pressian.com/pages/articles/268601', 'https://www.pressian.com/pages/articles/268580', 'https://www.pressian.com/pages/articles/268567', 'https://www.pressian.com/pages/articles/268521', 'https://www.pressian.com/pages/articles/268500', 'https://www.pressian.com/pages/articles/268516', 'https://www.pressian.com/pages/articles/268510', 'https://www.pressian.com/pages/articles/268493', 'https://www.pressian.com/pages/articles/268479', 'https://www.pressian.com/pages/articles/268467', 'https://www.pressian.com/pages/articles/268448', 'https://www.pressian.com/pages/articles/268450', 'https://www.pressian.com/pages/articles/268437', 'https://www.pressian.com/pages/articles/268429', 'https://www.pressian.com/pages/articles/268417', 'https://www.pressian.com/pages/articles/268416', 'https://www.pressian.com/pages/articles/268351', 'https://www.pressian.com/pages/articles/268348', 'https://www.pressian.com/pages/articles/268343', 'https://www.pressian.com/pages/articles/268340', 'https://www.pressian.com/pages/articles/268327', 'https://www.pressian.com/pages/articles/268300', 'https://www.pressian.com/pages/articles/268284', 'https://www.pressian.com/pages/articles/268256', 'https://www.pressian.com/pages/articles/268257', 'https://www.pressian.com/pages/articles/268203', 'https://www.pressian.com/pages/articles/268199', 'https://www.pressian.com/pages/articles/268192', 'https://www.pressian.com/pages/articles/268180', 'https://www.pressian.com/pages/articles/268167', 'https://www.pressian.com/pages/articles/268155', 'https://www.pressian.com/pages/articles/268112', 'https://www.pressian.com/pages/articles/268117', 'https://www.pressian.com/pages/articles/268072', 'https://www.pressian.com/pages/articles/268063', 'https://www.pressian.com/pages/articles/268054', 'https://www.pressian.com/pages/articles/268043', 'https://www.pressian.com/pages/articles/268018', 'https://www.pressian.com/pages/articles/268009', 'https://www.pressian.com/pages/articles/268022', 'https://www.pressian.com/pages/articles/267995', 'https://www.pressian.com/pages/articles/267998', 'https://www.pressian.com/pages/articles/267980', 'https://www.pressian.com/pages/articles/267973', 'https://www.pressian.com/pages/articles/267957', 'https://www.pressian.com/pages/articles/267939', 'https://www.pressian.com/pages/articles/267935', 'https://www.pressian.com/pages/articles/267927', 'https://www.pressian.com/pages/articles/267929', 'https://www.pressian.com/pages/articles/267902', 'https://www.pressian.com/pages/articles/267898', 'https://www.pressian.com/pages/articles/267883', 'https://www.pressian.com/pages/articles/267885', 'https://www.pressian.com/pages/articles/267890', 'https://www.pressian.com/pages/articles/267852', 'https://www.pressian.com/pages/articles/267791', 'https://www.pressian.com/pages/articles/267818', 'https://www.pressian.com/pages/articles/267806', 'https://www.pressian.com/pages/articles/267801', 'https://www.pressian.com/pages/articles/267780', 'https://www.pressian.com/pages/articles/267763']


#####################
# 전체 단어 빈도를 저장할 Counter 객체
total_word_counts = Counter()

okt = Okt()
for url in urls:
    response = requests.get(url)

    # HTML 파싱
    soup = BeautifulSoup(response.text, 'html.parser')

    # 기사 본문 선택
    article_body_elements = soup.select(
        'div#wrap>div#container>div.inner>div.article_view>div.section.pr10>div.article_body.article_body')
    for article_body_element in article_body_elements:
        # 특수 문자 제거 및 소문자 변환
        article_body = re.sub(r"[^\w\s]", "", str(article_body_element)).lower()

        # 명사 추출
        nouns = okt.nouns(article_body)

        ex.excluded_words.extend(["코로나","코로나바이러스"])

        # 단어 빈도 분석
        word_counts = Counter(word for word in nouns if word not in ex.excluded_words)

        # 단어 빈도를 전체 빈도에 누적
        total_word_counts += word_counts

# 가장 많이 등장한 단어 50개 추출
top_words = total_word_counts.most_common(50)

# 시각화를 위한 데이터 준비
labels, counts = zip(*top_words)
x = np.arange(len(labels))

# 막대 그래프 그리기
plt.bar(x, counts, align="center")
plt.xticks(x, labels)
plt.xlabel("단어")
plt.ylabel("빈도수")
plt.title("프레시안 코로나 <1달 전-경제> 관련 기사 단어 빈도수 분석")
plt.show()

# 결과 출력
print("프레시안 코로나 관련 <1달 전-경제> 기사 중 가장 많이 등장한 단어 50개:")
for word, count in top_words:
    print(f"{word}: {count}")

# 사용자 입력 대기
input("Press Enter to exit...")